name: Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: 16.x
      - run: yarn
      - run: yarn build
      - run: yarn deploy
        env:
          MINI_APPS_ACCESS_TOKEN: ${{ secrets.MINI_APPS_ACCESS_TOKEN }}
      - run: |
          VK_TOKEN=${{ secrets.VK_TOKEN }}
          VK_PEER_ID=${{ secrets.VK_PEER_ID }}

          VK_MESSAGE=$'üîî Workflow –∑–∞–≤–µ—Ä—à—ë–Ω\n\nüìö –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:' + ${{ github.repository }} + $'\nüå≥ –í–µ—Ç–∫–∞: '+ ${{ github.ref }} + $'\nüìÉ –ù–∞–∑–≤–∞–Ω–∏–µ: ' + ${{ github.workflow }} + $'\n‚öôÔ∏è –°—Ç–∞—Ç—É—Å: ' + ${{ github.event.check_run.conclusion }}

          PARAMS="access_token=$VK_TOKEN&v=5.131&peer_id=$VK_PEER_ID&message=$VK_MESSAGE"

          curl -d "$PARAMS" https://api.vk.com/method/messages.send
